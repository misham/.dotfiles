
[init]
  defaultBranch = main
  templateDir = ~/.git_template

[user]
  name = Misha Manulis

[include]
  path = ~/.gitconfig.local

[branch]
  autosetupmerge = true

[branch "master"]
  merge = refs/heads/master
  remote = origin

[branch "main"]
  merge = refs/heads/main
  remote = origin

[color]
  branch = auto
  diff = auto
  interactive = auto
  pager = true
  status = auto
  ui = true

[color "branch"]
  current = yellow reverse
  local = yellow
  remote = green

[color "diff"]
  frag = magenta bold
  meta = yellow bold
  new  = green bold
  old  = red bold

[color "status"]
  added = yellow
  changed = green
  untracked = cyan

[commit]
	verbose = true

[core]
  attributesfile = ~/.gitattributes
  autocrlf = input
  excludesfile = ~/.gitignore
  filemode = true
  logallrefupdates = true
  pager = delta
  whitespace=fix,-indent-with-non-tab,trailing-space,cr-at-eol

[credential]
	helper = osxkeychain

[delta]
  navigate = true  # use n and N to move between diff sections
  line-numbers = true

[diff]
  algorithm = histogram
  colorMoved = default
  mnemonicprefix = true
  renames = copies
  tool = nvimdiff

[diff "rspec"]
  xfuncname = "^[ \t]*((RSpec|describe|context|it|before|after|around|feature|scenario)[ \t].*)$"

[github]
  user = misham

[fetch]
  fsckobjects = true

[filter "lfs"]
  clean = git lfs clean %f
  required = true
  smudge = git lfs smudge %f

[http]
  cookiefile = ~/.gitcookies

[interactive]
  diffFilter = delta --color-only

[log]
	showSignature = true

[merge]
  conflictstyle = zdiff3
  tool = nvimdiff

# Mergiraf: syntax-aware merge driver (reduces conflicts)
# Install: cargo install mergiraf
# Runs automatically during merge/rebase/cherry-pick
[merge "mergiraf"]
  name = mergiraf
  driver = mergiraf merge --git %O %A %B -s %S -x %X -y %Y -p %P -l %L

# Neovim as merge tool (for remaining conflicts)
[mergetool]
  prompt = false
  keepBackup = false

[mergetool "nvimdiff"]
  cmd = nvim -d $LOCAL $MERGED $REMOTE -c 'wincmd l' -c 'wincmd J'

[difftool]
  prompt = false

[difftool "nvimdiff"]
  cmd = nvim -d $LOCAL $REMOTE

[rebase]
  autostash = true

[receive]
  fsckObjects = true

[transfer]
  fsckobjects = true

[url "git@github.com:"]
  insteadOf = https://github.com/

[url "git@gitlab.com:"]
  insteadOf = https://gitlab.com/

[alias]
  ci = commit
  st = status
  co = checkout
  br = branch
  hist = log --graph --abbrev-commit --decorate --date=short \
		--branches --remotes --tags \
    --format=format:'%C(bold cyan)%h%C(reset) %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)%an%C(reset) %C(bold yellow)%d%C(reset)' \
    --branches --remotes --tags

  # prune all tracking local branches that have been removed from remote:
  prune-all = !git remote | xargs -n 1 git remote prune
  # show list of contributors in descending order by number of commits
  rank = shortlog -sn --no-merges
  # given a string for an author, try to figure out full name and email:
  whois = "!sh -c 'git log -i -1 --pretty=\"format:%an <%ae>\n\" --author=\"$1\"' -"
  # given any git object, try to show it briefly
  whatis = show -s --pretty='tformat:%h (%s, %ad)' --date=short
  # Search for a given string in all patches and print commit messages
  # example: search for any commit that adds or removes string "foobar"
  #     git searchcommits foobar
  # example: search commits for string "foobar" in directory src/lib
  #     git searchcommits foobar src/lib
  # example: search commits for "foobar", print full diff of commit with 1 line context
  #     git searchcommits foobar --pickaxe-all -U1 src/lib
  searchcommits = "!f() { query=\"$1\"; shift; git log -S\"$query\" \"$@\"; }; f \"$@\""
  info = !~/.dotfiles/git/git-info
	ctags = !.git/hooks/ctags
  rm-remote = push origin --delete
  files = diff-tree --no-commit-id --name-only -r

[secrets]
	providers = git secrets --aws-provider
	patterns = (A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}
	patterns = (\"|')?(AWS|aws|Aws)?_?(SECRET|secret|Secret)?_?(ACCESS|access|Access)?_?(KEY|key|Key)(\"|')?\\s*(:|=>|=)\\s*(\"|')?[A-Za-z0-9/\\+=]{40}(\"|')?
	patterns = (\"|')?(AWS|aws|Aws)?_?(ACCOUNT|account|Account)_?(ID|id|Id)?(\"|')?\\s*(:|=>|=)\\s*(\"|')?[0-9]{4}\\-?[0-9]{4}\\-?[0-9]{4}(\"|')?
	allowed = AKIAIOSFODNN7EXAMPLE
	allowed = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
